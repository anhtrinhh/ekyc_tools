var __EkycToolsLibrary__;(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{EkycTools:()=>s});var r=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function c(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},n=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(l){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],n=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}},i=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},a=function(){function e(){}return e.handleScreen=function(e){var t=e.closest(".ekyct-container--inner");if(t.clientWidth>=t.clientHeight?t.classList.add("ekyct-container--rotate"):t.classList.remove("ekyct-container--rotate"),e){var r=parseFloat(e.dataset.shadingRatio||"0"),n=this.insertShadingElement(e,r);if(this.insertCanvasElement(e),n){var i=t.querySelector(".ekyct-header"),a=parseFloat(n.style.height.slice(0,-2));i&&t.classList.contains("ekyct-container--rotate")?i.style.height="".concat(a,"px"):i.style.height="unset"}}},e.insertCanvasElement=function(e){var t,r=e.querySelector(".ekyct-shading");if(e.querySelector(".ekyct-video")){var n=0,i=0,a=e.clientWidth,o=this.getCaptureRegionHeight(e);r&&(n=2*parseFloat(r.style.borderLeftWidth.slice(0,-2)),i=2*parseFloat(r.style.borderTopWidth.slice(0,-2)),a=parseFloat(r.style.width.slice(0,-2)),o=parseFloat(r.style.height.slice(0,-2))),null===(t=e.querySelector(".ekyct-canvas"))||void 0===t||t.remove();var c=a-n,l=o-i,s=document.createElement("canvas");return s.className="ekyct-canvas",s.style.width="".concat(c,"px"),s.style.height="".concat(l,"px"),s.style.display="none",e.appendChild(s),s}return null},e.insertShadingElement=function(e,t){var r,n=e.querySelector(".ekyct-video");if(n&&t>0){null===(r=e.querySelector(".ekyct-shading"))||void 0===r||r.remove();var i=n.clientWidth,a=this.getCaptureRegionHeight(e),o=document.createElement("div");o.className="ekyct-shading",o.style.width="".concat(i,"px"),o.style.height="".concat(a,"px");var c=this.getShadingBorderSize(i,a,t);return o.style.borderLeftWidth="".concat(c.borderX,"px"),o.style.borderRightWidth="".concat(c.borderX,"px"),o.style.borderTopWidth="".concat(c.borderY,"px"),o.style.borderBottomWidth="".concat(c.borderY,"px"),this.insertShaderBorders(o,this.shardBorderLargeSize,this.shardBorderSmallSize,-this.shardBorderSmallSize,null,0,!0),this.insertShaderBorders(o,this.shardBorderLargeSize,this.shardBorderSmallSize,-this.shardBorderSmallSize,null,0,!1),this.insertShaderBorders(o,this.shardBorderLargeSize,this.shardBorderSmallSize,null,-this.shardBorderSmallSize,0,!0),this.insertShaderBorders(o,this.shardBorderLargeSize,this.shardBorderSmallSize,null,-this.shardBorderSmallSize,0,!1),this.insertShaderBorders(o,this.shardBorderSmallSize,this.shardBorderLargeSize+this.shardBorderSmallSize,-this.shardBorderSmallSize,null,-this.shardBorderSmallSize,!0),this.insertShaderBorders(o,this.shardBorderSmallSize,this.shardBorderLargeSize+this.shardBorderSmallSize,null,-this.shardBorderSmallSize,-this.shardBorderSmallSize,!0),this.insertShaderBorders(o,this.shardBorderSmallSize,this.shardBorderLargeSize+this.shardBorderSmallSize,-this.shardBorderSmallSize,null,-this.shardBorderSmallSize,!1),this.insertShaderBorders(o,this.shardBorderSmallSize,this.shardBorderLargeSize+this.shardBorderSmallSize,null,-this.shardBorderSmallSize,-this.shardBorderSmallSize,!1),this.insertCircleRegion(o),e.appendChild(o),o}return null},e.insertShaderBorders=function(e,t,r,n,i,a,o){var c=document.createElement("div");c.className="ekyct-shader-border",c.style.width="".concat(t,"px"),c.style.height="".concat(r,"px"),null!==n&&(c.style.top="".concat(n,"px")),null!==i&&(c.style.bottom="".concat(i,"px")),o?c.style.left="".concat(a,"px"):c.style.right="".concat(a,"px"),e.appendChild(c)},e.getShadingBorderSize=function(t,r,n){var i,a=(t-(i=e.adjustExactRatio([t,r,n]))[0])/2,o=(r-i[1])/2;return o<3*this.shardBorderSmallSize&&(a+=3*this.shardBorderSmallSize-o,o=3*this.shardBorderSmallSize),a<3*this.shardBorderSmallSize&&(o+=3*this.shardBorderSmallSize-a,a=3*this.shardBorderSmallSize),{borderX:a,borderY:o}},e.cleanAlert=function(t){var r=t.querySelector(".ekyct-alert");r&&r.classList.contains("active")&&(e.insertAlertTimeout?setTimeout((function(){r.classList.remove("active"),setTimeout((function(){r.remove()}),200)}),400):(r.classList.remove("active"),setTimeout((function(){r.remove()}),200)))},e.insertAlert=function(t,r,n,i,a,o){if(void 0===o&&(o=2e3),t){var c=t.querySelector(".ekyct-alert");c?this.getAlertContent(c)!==r&&(c.classList.contains("active")&&!e.insertAlertTimeout&&c.classList.remove("active"),e.insertAlertTimeout||(this.setAlertContent(c,r),"number"==typeof o&&o>=1e3?e.setInsertAlertTimeout(c,o+200,200):c.classList.add("active"))):(c=this.createAlertElement(r,i,n,a),t.appendChild(c),c.classList.contains("active")||e.insertAlertTimeout||(this.setAlertContent(c,r),"number"==typeof o&&o>=1e3?e.setInsertAlertTimeout(c,o+20,20):c.classList.add("active")))}},e.createAlertElement=function(e,t,r,n){var a,o=document.createElement("div"),c=["ekyct-alert"];if("string"==typeof t&&t.trim().length>0||"boolean"==typeof n&&n){var l=document.createElement("div");if(l.className="ekyct-alert-header","string"==typeof t){t=t.trim();var s=document.createElement("div");s.className="ekyct-alert-title",l.appendChild(s),s.innerHTML=t,c.push("ekyct-alert-column")}if("boolean"==typeof n&&n){var d=document.createElement("button");d.className="ekyct-btn ekyct-close-btn",d.innerHTML='<svg viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',d.addEventListener("click",(function(e){e.preventDefault(),o.classList.remove("active")}),{once:!0}),l.appendChild(d)}o.appendChild(l)}var u=document.createElement("div");return u.className="ekyct-alert-body",o.appendChild(u),Array.isArray(r)&&r.length>0&&(c=i(i([],c,!0),r,!0)),"string"==typeof e&&e.trim().length>0&&(e=e.trim(),u.innerHTML=e),(a=o.classList).add.apply(a,c),o},e.setAlertContent=function(e,t){if("string"==typeof t&&t.trim().length>0){var r=e.querySelector(".ekyct-alert-body");r&&(r.innerHTML=t)}},e.getAlertContent=function(e){var t=e.querySelector(".ekyct-alert-body");return t?t.innerHTML:""},e.setInsertAlertTimeout=function(t,r,n){e.insertAlertTimeout=setTimeout((function(){t.classList.add("active"),setTimeout((function(){e.clearInsertAlertTimeout()}),r)}),n)},e.clearInsertAlertTimeout=function(){e.insertAlertTimeout&&(clearTimeout(e.insertAlertTimeout),e.insertAlertTimeout=null)},e.delay=function(e){return new Promise((function(t){setTimeout(t,e)}))},e.toggleLoader=function(t,r){if(void 0===t&&(t=!0),void 0===r&&(r=document.body),r){var n=r.querySelector(".ekyct-loader");if(n&&n.remove(),t){var i=e.createLoaderElement();r.appendChild(i)}}},e.toggleLoaderOnCaptureRegion=function(e,t){void 0===e&&(e=!0),t&&(e?t.classList.add("ekyct-hide-shading"):t.classList.remove("ekyct-hide-shading"),this.toggleLoader(e,t))},e.insertCircleRegion=function(e){var t=document.createElement("div"),r=parseFloat(e.style.width.slice(0,-2))-2*parseFloat(e.style.borderLeftWidth.slice(0,-2));t.className="ekyct-circle-region";for(var n=0;n<100;n++){var i=document.createElement("div");i.className="ekyct-circle-region-point",t.appendChild(i),i.style.transform="rotate(".concat(3.6*n,"deg) translateY(").concat(r/2-10,"px)")}e.appendChild(t)},e.createLoaderElement=function(){var e=document.createElement("div");e.className="ekyct-loader";var t=document.createElement("div");t.className="ekyct-loader-content";for(var r=1;r<=10;r++){var n=document.createElement("span");n.setAttribute("style","--i:"+r),t.appendChild(n)}return e.appendChild(t),e},e.newGuid=function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),t=new Date;return e+="".concat(t.getUTCFullYear()),t.getUTCMonth()<9?e+="0".concat(t.getUTCMonth()+1):e+=t.getUTCMonth()+1,t.getUTCDate()<10?e+="0".concat(t.getUTCDate()):e+="".concat(t.getUTCDate()),t.getUTCHours()<10?e+="0".concat(t.getUTCHours()):e+=t.getUTCHours(),t.getUTCMinutes()<10?e+="0".concat(t.getUTCMinutes()):e+=t.getUTCMinutes(),t.getUTCSeconds()<10?e+="0".concat(t.getUTCSeconds()):e+=t.getUTCSeconds(),e},e.getCapabilitiesOfFacingMode=function(t){return r(this,void 0,void 0,(function(){var r,i,a;return n(this,(function(n){switch(n.label){case 0:if("environment"!==t&&"user"!==t)return[2,void 0];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:{exact:t}}})];case 2:return r=n.sent(),i=r.getVideoTracks()[0],a=i.getCapabilities(),e.clearMediaStream(r),[2,a];case 3:return n.sent(),[2,void 0];case 4:return[2]}}))}))},e.getCapabilitiesBothCam=function(){return r(this,void 0,void 0,(function(){var t,r,i,a,o;return n(this,(function(n){switch(n.label){case 0:return[4,e.getCapabilitiesOfFacingMode("user")];case 1:return t=n.sent(),[4,e.getCapabilitiesOfFacingMode("environment")];case 2:return r=n.sent(),a=null,(i=void 0!==t||void 0!==r)?t?[3,4]:[4,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}})]:[3,7];case 3:return a=n.sent(),o=a.getVideoTracks()[0],t=o.getCapabilities(),[3,6];case 4:return r?[3,6]:[4,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}})];case 5:a=n.sent(),o=a.getVideoTracks()[0],r=o.getCapabilities(),n.label=6;case 6:return[3,9];case 7:return[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 8:a=n.sent(),o=a.getVideoTracks()[0],t=o.getCapabilities(),n.label=9;case 9:return e.clearMediaStream(a),[2,{hasBoth:i,frontCamCapabilities:t,rearCamCapabilities:r}]}}))}))},e.clearMediaStream=function(e){e&&e.getTracks().forEach((function(t){null==e||e.removeTrack(t),t.stop()}))},e.adjustRatio=function(e){var t=e[0],r=e[1],n=e[2];if(t/r===n)return[t,r];var i=Math.min(t,Math.floor(r*n));return[i,Math.round(i/n)]},e.adjustExactRatio=function(e){var t=e[0],r=e[1],n=e[2];if(t/r===n)return[t,r];var i=Math.min(t,r*n);return[i,i/n]},e.requestFullscreen=function(){return r(this,void 0,void 0,(function(){var e;return n(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),document.fullscreenEnabled?[4,document.documentElement.requestFullscreen()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[3,4];case 3:return e=t.sent(),console.warn(e),[3,4];case 4:return[2]}}))}))},e.exitFullscreen=function(){return r(this,void 0,void 0,(function(){var e;return n(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),null==document.fullscreenElement?[3,2]:[4,document.exitFullscreen()];case 1:t.sent(),t.label=2;case 2:return[3,4];case 3:return e=t.sent(),console.warn(e),[3,4];case 4:return[2]}}))}))},e.getVideoRatios=function(e,t){var r=e.videoWidth/e.clientWidth,n=e.videoHeight/e.clientHeight,i=r,a=n;return"number"==typeof t&&t>0&&(r>=n?r>t&&(i=t,a=t/(r/n)):n>t&&(a=t,i=t/(n/r))),{originWidthRatio:r,originHeightRatio:n,newWidthRatio:i,newHeightRatio:a}},e.getCaptureRegionHeight=function(e){var t=e.closest(".ekyct-container--inner"),r=e.querySelector(".ekyct-video"),n=180;t.classList.contains("ekyct-container--rotate")&&(n=0);var i=window.innerHeight-n;return r&&i>r.clientHeight&&(i=r.clientHeight),i},e.getCanvasContextWidth=function(t,r,n,i){var a=0,o=n;r&&(a=parseFloat(r.style.borderLeftWidth.slice(0,-2)),o=parseFloat(r.style.width.slice(0,-2)));var c=e.getVideoRatios(t,i).newWidthRatio,l=o-2*a,s=Math.round(l*c);return s%2!=0&&(s-=1),s},e.getInnerElementsInCaptureDiv=function(e){return{canvasEl:e.querySelector(".ekyct-canvas"),videoEl:e.querySelector(".ekyct-video"),shadingEl:e.querySelector(".ekyct-shading")}},e.insertAlertTimeout=null,e.shardBorderLargeSize=40,e.shardBorderSmallSize=5,e}(),o=function(){return o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},o.apply(this,arguments)},c=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function c(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},l=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(l){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,n=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],n=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}},s=function(){function e(){var e=this;this.mediaStream=null,this.currentFacingMode="environment",this.defaultGetImageOptions={enableFilePicker:!0,enableSwitchCamera:!0,shadingRatio:1.66666667,facingMode:"environment",mimeType:"image/png",quality:.99,onStop:function(){return e.closeOcrWindow()}},this.defaultGetVideoOptions={enableSwitchCamera:!0,facingMode:"user",shadingRatio:1,recordMs:6e3,mimeType:"video/webm",onStop:function(){return e.closeOcrWindow()}}}return e.getAvailableCameraDevices=function(){return c(this,void 0,void 0,(function(){var e,t,r,n,i,o;return l(this,(function(c){switch(c.label){case 0:return[4,this.getCameraDevices()];case 1:e=c.sent(),t=[],r=0,c.label=2;case 2:if(!(r<e.length))return[3,7];n=e[r],c.label=3;case 3:return c.trys.push([3,5,,6]),[4,navigator.mediaDevices.getUserMedia({video:{deviceId:n.deviceId},audio:!1})];case 4:return i=c.sent(),a.clearMediaStream(i),t.push(n),[3,6];case 5:return o=c.sent(),console.warn(o),[3,6];case 6:return r++,[3,2];case 7:return[2,t]}}))}))},e.getCameraDevices=function(){return c(this,void 0,void 0,(function(){var e;return l(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,navigator.mediaDevices.enumerateDevices()];case 1:return[2,t.sent().filter((function(e){return"videoinput"===e.kind}))];case 2:return e=t.sent(),console.error(e),[2,[]];case 3:return[2]}}))}))},e.prototype.getImage=function(e){var t,r=this;void 0===e&&(e={}),e=o(o({},this.defaultGetImageOptions),e);var n=this.createBasicLayout(e);document.body.appendChild(n),null===(t=n.querySelector(".ekyct-close-btn"))||void 0===t||t.addEventListener("click",(function(e){e.preventDefault(),r.closeOcrWindow()})),e.enableFilePicker&&this.handleFilePicker(e,n,"image/jpeg,image/png,image/webp"),this.handleCapture(e,n)},e.prototype.getVideo=function(e){var t,r,n=this;void 0===e&&(e={}),e=o(o({},this.defaultGetVideoOptions),e);var i=this.createBasicLayout(e);document.body.appendChild(i),null===(t=i.querySelector(".ekyct-capture-region"))||void 0===t||t.classList.add("ekyct-hide-shader-border"),null===(r=i.querySelector(".ekyct-close-btn"))||void 0===r||r.addEventListener("click",(function(e){e.preventDefault(),n.closeOcrWindow()})),this.handleRecord(e,i)},e.prototype.handleFilePicker=function(e,t,r){var n,i=this,o=document.createElement("input");o.type="file",o.accept=r,o.onchange=function(){if(o.files){var t=o.files[0],r=t.name.match(/\.(png|jpg|jpeg|webp)$/i);r&&r.length>0&&e.onStop&&e.onStop({blob:t,contentName:"".concat(a.newGuid()).concat(r[0].toLowerCase()),contentLength:t.size,contentType:t.type})}},null===(n=t.querySelector(".ekyct-filepicker-btn"))||void 0===n||n.addEventListener("click",(function(t){t.preventDefault(),o.click(),e.onStart&&e.onStart(i.container)}))},e.prototype.handleRecord=function(e,t){return c(this,void 0,void 0,(function(){var r,n=this;return l(this,(function(i){switch(i.label){case 0:return(r=t.querySelector(".ekyct-record-btn"))?(a.toggleLoaderOnCaptureRegion(!0,t.querySelector(".ekyct-capture-region")),[4,this.setupCamera(t,e)]):[3,2];case 1:return i.sent(),r.addEventListener("click",(function(r){return c(n,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,this.handleClickRecord(r,e,t)];case 1:return[2,n.sent()]}}))}))})),a.toggleLoaderOnCaptureRegion(!1,t.querySelector(".ekyct-capture-region")),[3,3];case 2:e.onError&&e.onError("Record button not exists!"),i.label=3;case 3:return[2]}}))}))},e.prototype.handleClickRecord=function(e,t,r){var n;return c(this,void 0,void 0,(function(){var i,s,d,u,h,p,y,g,m,v,f,b,k,x,S,w,C,E,M,B,T,L,R,z=this;return l(this,(function(q){if(t.onStart&&t.onStart(this.container),e.preventDefault(),i=t.recordMs||6e3,this.toggleDisabledButtons(r),d=r.querySelector("div.ekyct-capture-region"))if(t.alert&&t.alert.removeOnOcr&&(null===(n=d.querySelector(".ekyct-alert"))||void 0===n||n.remove()),(u=a.getInnerElementsInCaptureDiv(d)).canvasEl){h=null,p="string"==typeof t.mimeType&&["video/webm","video/mp4"].includes(t.mimeType)?t.mimeType:"video/webm",y=u.canvasEl.captureStream(),g=a.getCanvasContextWidth(u.videoEl,u.shadingEl,d.clientWidth,t.maxCanvasRatio),m={willReadFrequently:!0},v=u.canvasEl.getContext("2d",m),f=o({captureRegionEl:d,canvasContext:v,videoEl:u.videoEl,shadingEl:u.shadingEl,canvasContextWidth:g},a.getVideoRatios(u.videoEl,t.maxCanvasRatio)),b=d.querySelectorAll(".ekyct-circle-region-point"),k=[],w=0,C=0,E=0,M=0,B=0,T=0;try{L=new MediaRecorder(y,{mimeType:p,videoBitsPerSecond:t.videoBitsPerSecond})}catch(e){console.warn(e),L=new MediaRecorder(y,{videoBitsPerSecond:t.videoBitsPerSecond}),p="video/webm"}L.ondataavailable=function(e){return c(z,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return k.push(e.data),null!=h?[3,2]:[4,this.getObjectFromCaptureRegion(u.canvasEl,"image/png",this.defaultGetImageOptions.quality)];case 1:h=t.sent(),t.label=2;case 2:return[2]}}))}))},L.onstart=function(){T=(performance||Date).now()},R=function(){return c(z,void 0,void 0,(function(){var e,n,o,c;return l(this,(function(l){switch(l.label){case 0:return x=(performance||Date).now(),this.handleScan(f),[4,a.delay(10)];case 1:return l.sent(),S=(performance||Date).now(),M+=S-x,++E,"recording"===L.state&&T>0?C=(e=(S-T)/i)>=1?100:Math.floor(100*e):"inactive"===L.state&&L.start(),(S-B>=1e3||100===C)&&(M/E,M=0,E=0,b.forEach((function(e,t){t<C?e.classList.add("ekyct-circle-region-point--marked"):e.classList.remove("ekyct-circle-region-point--marked")})),B=S),100!==C?[3,4]:[4,this.stopMediaRecorder(L)];case 2:return l.sent(),a.clearMediaStream(y),window.cancelAnimationFrame(w),n=null,k.length>0&&(o=new Blob(k,{type:p}),c="video/mp4"===p?".mp4":".webm",n={blob:o,posterBlob:h,contentLength:o.size,contentType:o.type,contentName:"".concat(a.newGuid()).concat(c)}),this.toggleDisabledButtons(r,!1),t.onStop&&t.onStop(n),[4,a.delay(300)];case 3:return l.sent(),b.forEach((function(e){return e.classList.remove("ekyct-circle-region-point--marked")})),[3,5];case 4:w=requestAnimationFrame(R),l.label=5;case 5:return[2]}}))}))},R()}else s="Canvas not exists!";else s="Capture region not exists!";return s&&t.onError&&(this.toggleDisabledButtons(r,!1),t.onError(s)),[2]}))}))},e.prototype.stopMediaRecorder=function(e){return c(this,void 0,void 0,(function(){var t;return l(this,(function(r){switch(r.label){case 0:return e?"recording"!==e.state?[3,2]:(t=function(){return new Promise((function(t,r){e.onstop=t,e.onerror=function(){return r("An error occured!")}}))},e.stop(),[4,t()]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},e.prototype.handleCapture=function(e,t){return c(this,void 0,void 0,(function(){var r,n,i=this;return l(this,(function(s){switch(s.label){case 0:return(r=t.querySelector(".ekyct-capture-btn"))?(a.toggleLoaderOnCaptureRegion(!0,t.querySelector(".ekyct-capture-region")),[4,this.setupCamera(t,e)]):[3,2];case 1:return s.sent(),r.addEventListener("click",(function(r){return c(i,void 0,void 0,(function(){var i,c,s,d,u,h,p,y,g,m,v,f;return l(this,(function(l){switch(l.label){case 0:return e.onStart&&e.onStart(this.container),r.preventDefault(),(i=t.querySelector("div.ekyct-capture-region"))?(e.alert&&e.alert.removeOnOcr&&(null===(f=i.querySelector(".ekyct-alert"))||void 0===f||f.remove()),c=a.getInnerElementsInCaptureDiv(i),s=a.getCanvasContextWidth(c.videoEl,c.shadingEl,i.clientWidth,e.maxCanvasRatio),d={willReadFrequently:!0},u=c.canvasEl.getContext("2d",d),h=o({captureRegionEl:i,canvasContext:u,videoEl:c.videoEl,shadingEl:c.shadingEl,canvasContextWidth:s},a.getVideoRatios(c.videoEl,e.maxCanvasRatio)),this.toggleDisabledButtons(t),a.toggleLoaderOnCaptureRegion(!0,t.querySelector(".ekyct-capture-region")),this.handleScan(h),p="string"==typeof e.mimeType&&["image/jpeg","image/png","image/webp"].includes(e.mimeType)?e.mimeType:this.defaultGetImageOptions.mimeType,y="number"==typeof e.quality&&e.quality>=0&&e.quality<=1?e.quality:this.defaultGetImageOptions.quality,g="image/webp"===p?".webp":"image/jpeg"===p?".jpg":".png",[4,this.getObjectFromCaptureRegion(c.canvasEl,p,y)]):[3,2];case 1:return m=l.sent(),v=null,m&&(v={blob:m,contentLength:m.size,contentName:"".concat(a.newGuid()).concat(g),contentType:p}),this.toggleDisabledButtons(t,!1),e.onStop&&e.onStop(v),a.toggleLoaderOnCaptureRegion(!1,t.querySelector(".ekyct-capture-region")),[3,3];case 2:n="Capture region not exists!",l.label=3;case 3:return[2]}}))}))})),a.toggleLoaderOnCaptureRegion(!1,t.querySelector(".ekyct-capture-region")),[3,3];case 2:n="Capture button not exists!",s.label=3;case 3:return n&&e.onError&&(this.toggleDisabledButtons(t,!1),e.onError(n)),[2]}}))}))},e.prototype.getObjectFromCaptureRegion=function(e,t,r){return c(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return e?[4,this.getBlobFromCanvas(e,t,r)]:[3,2];case 1:return[2,n.sent()];case 2:return[2,null]}}))}))},e.prototype.getBlobFromCanvas=function(e,t,r){return new Promise((function(n){e.toBlob((function(e){return n(e)}),t,r)}))},e.prototype.handleScan=function(e){var t=e.videoEl,r=e.captureRegionEl,n=e.shadingEl,i=e.originWidthRatio,o=e.originHeightRatio,c=e.newWidthRatio,l=e.newHeightRatio,s=e.canvasContext,d=0,u=0,h=r.clientWidth,p=a.getCaptureRegionHeight(r);n&&(d=parseFloat(n.style.borderLeftWidth.slice(0,-2)),u=parseFloat(n.style.borderTopWidth.slice(0,-2)),h=parseFloat(n.style.width.slice(0,-2)),p=parseFloat(n.style.height.slice(0,-2)));var y=h-2*d,g=p-2*u,m=Math.round(y*i),v=Math.round(g*o);m%2!=0&&(m-=1),v%2!=0&&(v-=1);var f=0;t.clientHeight>p&&(f=(t.clientHeight-p)/2);var b=Math.round(d*i),k=Math.round((u+f)*o),x=Math.round(y*c),S=Math.round(g*l);x%2!=0&&(x-=1),S%2!=0&&(S-=1),s.canvas.width=x,s.canvas.height=S,s.drawImage(t,b,k,m,v,0,0,x,S)},e.prototype.createBasicLayout=function(t){var r,n;this.validateEkycToolOptions(t);var i=document.createElement("div"),o=document.createElement("div");o.className="ekyct-container--inner",o.insertAdjacentHTML("beforeend",'<style>.ekyct-container,.ekyct-container *{margin:0;padding:0;box-sizing:border-box}.ekyct-capture-region.ekyct-hide-shading .ekyct-shading,.ekyct-dnone{display:none!important}.ekyct-body,.ekyct-capture-region,.ekyct-container,.ekyct-container--inner{display:flex;height:100%}.ekyct-container{position:fixed;top:0;left:0;background-color:#202124;z-index:999;width:100%;font-family:Arial,Helvetica,sans-serif;align-items:center;justify-content:center}.ekyct-container--inner{flex-direction:column;width:100%;max-width:1120px}.ekyct-container--rotate{align-items:center;flex-direction:row}.ekyct-container--rotate .ekyct-capture-region{max-width:960px}.ekyct-container--rotate .ekyct-footer,.ekyct-container--rotate .ekyct-header{width:unset;height:100%}.ekyct-container--rotate .ekyct-footer--inner,.ekyct-container--rotate .ekyct-header--inner{width:unset;height:100%;flex-direction:column-reverse}.ekyct-btn{border:none;outline:0;background-color:#3c4043;color:#fff;padding:16px;cursor:pointer;line-height:0;border-radius:50%}.ekyct-btn:hover{background-color:#4b5053}.ekyct-btn:active{background-color:#5a5f63}.ekyct-btn:disabled{background-color:#2b2d30;color:#727275;cursor:default}.ekyct-btn svg{fill:currentColor;width:28px;height:28px}.ekyct-body{width:100%;align-items:center;justify-content:center}.ekyct-capture-region{width:100%;position:relative;flex-grow:1;align-items:center;justify-content:center;overflow:hidden}.ekyct-hide-shader-border .ekyct-shading{overflow:hidden}.ekyct-circle-region{display:none}.ekyct-hide-shader-border .ekyct-circle-region{display:flex;width:100%;height:100%;justify-content:center;align-items:center;rotate:180deg;border-radius:50%;box-shadow:0 0 0 1000px rgba(0,0,0,.5)}.ekyct-circle-region-point{width:4px;height:16px;background-color:rgba(0,0,0,.5);position:absolute;border-radius:4px;transition:10ms ease-in-out}.ekyct-circle-region-point--marked{background-color:#0f0;box-shadow:0 0 10px #0f0}.ekyct-alert,.ekyct-shader-border{background-color:#fff;position:absolute}.ekyct-footer,.ekyct-header{width:100%}.ekyct-header--inner{width:100%;display:flex;justify-content:flex-end;padding:20px}.ekyct-header--inner .ekyct-btn{padding:6px}.ekyct-footer--inner{width:100%;display:flex;padding:20px;justify-content:center;gap:1rem}.ekyct-cam-error{width:100%;height:100%}.ekyct-cam-error--inner{width:100%;height:100%;display:flex;justify-content:center;align-items:center;flex-direction:column}.ekyct-cam-error--inner p,.ekyct-cam-error--inner span{color:#ff5100;font-size:12px;text-align:center}.ekyct-cam-error--inner svg{fill:currentColor;width:100px;height:100px}.ekyct-shading{position:absolute;border-style:solid;border-color:rgba(0,0,0,.5);z-index:2}.ekyct-video{width:100%;display:block;position:absolute;z-index:-2}.ekyct-alert{top:10px;right:-10px;transform:translateX(100%);border-radius:4px;font-size:12px;transition:.2s ease-out;max-width:80%;text-align:left;display:flex;z-index:10}.ekyct-alert-header{border-bottom:1px solid rgba(0,0,0,.08);padding:8px 0 8px 4px;display:flex;align-items:center;flex-direction:column}.ekyct-alert.ekyct-alert-column{flex-direction:column}.ekyct-alert.ekyct-alert-reverse{flex-direction:row-reverse}.ekyct-alert-column.ekyct-alert-reverse{flex-direction:column-reverse}.ekyct-alert-reverse .ekyct-alert-header{padding:8px 4px 8px 0}.ekyct-alert-column .ekyct-alert-header{padding:4px 8px;gap:8px;flex-direction:row}.ekyct-alert-header .ekyct-close-btn{background-color:unset;color:rgba(0,0,0,.6);padding:0}.ekyct-alert-header .ekyct-close-btn:hover{color:rgba(0,0,0,.8)}.ekyct-alert-header .ekyct-close-btn:active{color:#000}.ekyct-alert-header .ekyct-close-btn svg{width:16px;height:16px}.ekyct-alert-title{font-weight:700;font-size:16px;flex-grow:1;vertical-align:middle;overflow:hidden;-webkit-line-clamp:1;display:box;display:-webkit-box;-webkit-box-orient:vertical;text-overflow:ellipsis;white-space:normal}.ekyct-alert-body{padding:8px}.ekyct-alert.warning{border:1px solid #ffae00;color:#ffae00}.ekyct-alert.active{right:10px;transform:translateX(0)}.ekyct-loader{position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:100}.ekyct-loader-content{position:relative;width:48px;height:48px}.ekyct-loader-content span{position:absolute;top:0;left:0;width:100%;height:100%;transform:rotate(calc(36deg * var(--i)))}.ekyct-loader-content span::before{content:"";position:absolute;top:0;left:0;width:12px;height:12px;border-radius:50%;background-color:rgba(254,254,254,.8);transform:scale(0);animation:1s linear infinite loaderAnimate;animation-delay:calc(.1s * var(--i))}@keyframes loaderAnimate{0%{transform:scale(1)}100%,80%{transform:scale(0)}}@media (min-width:768px){.ekyct-alert,.ekyct-cam-error--inner p,.ekyct-cam-error--inner span{font-size:14px}.ekyct-alert-header{padding:10px 0 10px 6px}.ekyct-alert-reverse .ekyct-alert-header{padding:10px 6px 10px 0}.ekyct-alert-column .ekyct-alert-header{padding:6px 10px;gap:10px}.ekyct-alert-reverse.ekyct-alert-column .ekyct-alert-header{border-top:1px solid rgba(0,0,0,.08);border-bottom:unset}.ekyct-alert-header .ekyct-close-btn svg{width:18px;height:18px}.ekyct-alert-title{font-size:18px}.ekyct-alert-body{padding:10px}.ekyct-cam-error--inner svg{width:140px;height:140px}.ekyct-loader-content{width:54px;height:54px}.ekyct-loader-content span::before{width:14px;height:14px}}@media (min-width:992px){.ekyct-loader-content{width:60px;height:60px}.ekyct-loader-content span::before{width:16px;height:16px}}</style>'),i.className="ekyct-container",i.dataset.version=e.VERSION;var c=document.createElement("div");c.dataset.shadingRatio=null===(n=t.shadingRatio)||void 0===n?void 0:n.toString(),c.className="ekyct-capture-region";var l=this.createFooter(t),s=document.createElement("div");if(s.className="ekyct-body",t.alert){var d=(r=t.alert).displayTimeout,u=r.enableCloseBtn,h=r.classList,p=r.content,y=r.title;a.insertAlert(c,p,h,y,u,d)}return s.appendChild(c),o.appendChild(this.createHeader()),o.appendChild(s),o.appendChild(l),i.appendChild(o),this.container=i,i},e.prototype.setupCamera=function(e,t){var r,n;return c(this,void 0,void 0,(function(){var i,o,c,s,d,u=this;return l(this,(function(l){switch(l.label){case 0:i=e.querySelector(".ekyct-capture-region"),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.getCapabilitiesBothCam()];case 2:return o=l.sent(),c={width:t.width,height:t.height,aspectRatio:t.aspectRatio,frameRate:t.frameRate,facingMode:t.facingMode},this.toggleDisabledButtons(e),[4,this.insertVideoElement(i,this.getVideoConstraints(o,c))];case 3:return l.sent(),a.handleScreen(i),this.toggleDisabledButtons(e,!1),s=e.querySelector(".ekyct-switchcam-btn"),t.enableSwitchCamera&&o.hasBoth?(null==s||s.classList.remove("ekyct-dnone"),null==s||s.addEventListener("click",(function(t){t.preventDefault(),u.toggleDisabledButtons(e),u.toggleFacingMode(),c.facingMode=u.currentFacingMode,u.insertVideoElement(i,u.getVideoConstraints(o,c)).then((function(){a.handleScreen(i),u.toggleDisabledButtons(e,!1)}))}))):(null==s||s.remove(),this.toggleDisabledButtons(e,!1)),[3,5];case 4:return d=l.sent(),null===(r=e.querySelector(".ekyct-capture-btn"))||void 0===r||r.remove(),null===(n=e.querySelector(".ekyct-record-btn"))||void 0===n||n.remove(),i.appendChild(this.createNotHasCamElement()),this.toggleDisabledButtons(e,!1),console.error(d),[3,5];case 5:return[2]}}))}))},e.prototype.toggleDisabledButtons=function(e,t){if(void 0===t&&(t=!0),e){var r=e.querySelector(".ekyct-switchcam-btn"),n=e.querySelector(".ekyct-capture-btn"),i=e.querySelector(".ekyct-record-btn"),a=e.querySelector(".ekyct-filepicker-btn"),o=e.querySelector(".ekyct-close-btn");r&&(r.disabled=t),n&&(n.disabled=t),i&&(i.disabled=t),a&&(a.disabled=t),o&&(o.disabled=t)}},e.prototype.toggleFacingMode=function(){this.currentFacingMode="environment"===this.currentFacingMode?"user":"environment"},e.prototype.validateEkycToolOptions=function(e){if(e.enableSwitchCamera||(e.enableSwitchCamera=!1),("number"!=typeof e.aspectRatio||e.aspectRatio<0)&&(e.aspectRatio=1),("number"!=typeof e.shadingRatio||e.shadingRatio<0)&&(e.shadingRatio=0),Array.isArray(e.facingMode)&&e.facingMode.length>0&&["environment","user"].includes(e.facingMode[0]))e.facingMode=e.facingMode[0];else if("object"==typeof e.facingMode){var t=e.facingMode;"environment"!==t.exact&&"user"!==t.exact&&(e.facingMode="environment")}else"environment"===e.facingMode||"user"===e.facingMode?e.facingMode=e.facingMode:e.facingMode="environment"},e.prototype.createNotHasCamElement=function(){var t=document.createElement("div");t.className="ekyct-cam-error";var r=document.createElement("div");r.className="ekyct-cam-error--inner";var n=document.createElement("p");n.innerHTML='<svg viewBox="0 0 24 24"><path d="M12 5.99 19.53 19H4.47L12 5.99M12 2 1 21h22L12 2z"></path><path d="M13 16h-2v2h2zm0-6h-2v5h2z"></path></svg>';var i=document.createElement("p");return i.innerText=e.CAMERA_NOT_FOUND_WARNING,r.append(n,i),t.appendChild(r),t},e.prototype.insertVideoElement=function(e,t){var r;return c(this,void 0,void 0,(function(){var n;return l(this,(function(i){switch(i.label){case 0:return a.clearMediaStream(this.mediaStream),null===(r=e.querySelector(".ekyct-video"))||void 0===r||r.remove(),[4,this.createVideoElement(t)];case 1:return n=i.sent(),this.currentFacingMode=t.facingMode,e.appendChild(n),[2]}}))}))},e.prototype.getVideoConstraints=function(e,t){var r,n={},i=e.rearCamCapabilities,c=e.frontCamCapabilities,l=t.width,s=t.height,d=t.frameRate,u=t.aspectRatio,h=e.hasBoth?t.facingMode:void 0;h&&(n.facingMode=h);var p=function(e,t,r){if(e[t]){var i=e[t].max;"number"==typeof r&&r>0?(i&&r>i&&(r=i),n[t]=r):"object"==typeof r&&"ideal"in r&&"number"==typeof r.ideal&&r.ideal>0&&(i&&r.ideal>i&&(r.ideal=i),r.max&&r.ideal>r.max&&(r.max=r.ideal),n[t]=r)}};if("environment"===h?(l&&p(i,"width",l),s&&p(i,"height",s)):(l&&p(c,"width",l),s&&p(c,"height",s)),d&&(n.frameRate=d),"number"==typeof u&&u>0&&n.width&&n.height){var y=n.width,g=n.height,m=y.ideal||y,v=g.ideal||g,f=(r=a.adjustRatio([m,v,u]))[0],b=r[1];n.width=y.ideal?o(o({},y),{ideal:f}):f,n.height=g.ideal?o(o({},g),{ideal:b}):b}return n},e.prototype.closeOcrWindow=function(){a.clearMediaStream(this.mediaStream),this.container&&document.body.removeChild(this.container)},e.prototype.createHeader=function(){var e=document.createElement("div");e.className="ekyct-header";var t=document.createElement("div");t.className="ekyct-header--inner";var r=document.createElement("button");return r.className="ekyct-btn ekyct-close-btn",r.disabled=!0,r.innerHTML='<svg viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',t.appendChild(r),e.appendChild(t),e},e.prototype.createFooter=function(e){var t=document.createElement("div");t.className="ekyct-footer";var r=document.createElement("div");if(r.className="ekyct-footer--inner",e.enableFilePicker){var n=document.createElement("button");n.className="ekyct-btn ekyct-filepicker-btn",n.innerHTML='<svg viewBox="0 0 24 24"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"></path></svg>',n.disabled=!0,r.appendChild(n)}if(this.instanceOfCaptureEkycToolOptions(e)){var i=document.createElement("button");i.className="ekyct-btn ekyct-capture-btn",i.innerHTML='<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2"></circle><path d="M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"></path></svg>',i.disabled=!0,r.appendChild(i)}else{var a=document.createElement("button");a.className="ekyct-btn ekyct-record-btn",a.innerHTML='<svg viewBox="0 0 24 24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"></path></svg>',a.disabled=!0,r.appendChild(a)}if(e.enableSwitchCamera){var o=document.createElement("button");o.className="ekyct-btn ekyct-switchcam-btn ekyct-dnone",o.innerHTML='<svg viewBox="0 0 24 24"><path d="M16 7h-1l-1-1h-4L9 7H8c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zm-4 7c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"></path><path d="m8.57.51 4.48 4.48V2.04c4.72.47 8.48 4.23 8.95 8.95h2C23.34 3.02 15.49-1.59 8.57.51zm2.38 21.45c-4.72-.47-8.48-4.23-8.95-8.95H0c.66 7.97 8.51 12.58 15.43 10.48l-4.48-4.48v2.95z"></path></svg>',o.disabled=!0,r.appendChild(o)}return t.appendChild(r),t},e.prototype.instanceOfCaptureEkycToolOptions=function(e){return"enableFilePicker"in e},e.prototype.createVideoElement=function(e){var t=this;return new Promise((function(r){var n=document.createElement("video");n.className="ekyct-video",n.muted=!0,n.playsInline=!0;var i=function(){n.removeEventListener("playing",i),r(n)};n.addEventListener("playing",i);var a={audio:!1,video:e};navigator.mediaDevices.getUserMedia(a).then((function(e){t.mediaStream=e,n.srcObject=e,n.play()}))}))},e.VERSION="1.0.1-cpt",e.CAMERA_NOT_FOUND_WARNING="Không tìm thấy hoặc không thể kết nối với máy ảnh trên thiết bị của bạn!",e}();window.addEventListener("resize",(function(){document.querySelectorAll("div.ekyct-capture-region").forEach((function(e){a.handleScreen(e)}))})),__EkycToolsLibrary__=t})();if(window){if(!EkycTools){var EkycTools=window.__EkycToolsLibrary__.EkycTools}}